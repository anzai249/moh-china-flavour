namespace = moh_historical
moh_historical.1 = {
	# may 4 movement
	type = country_event
	placement = root
	title = moh_historical.1.t
	desc = moh_historical.1.d
	flavor = moh_historical.1.f
	dlc = dlc0moh
	event_image = {
		video = "asia_protest"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/event_icons/event_scales.dds"
	duration = 3
	trigger = {
		OR = {
			country_has_primary_culture = cu:han
			country_has_primary_culture = cu:manchu
			country_has_primary_culture = cu:min
			country_has_primary_culture = cu:hakka
			country_has_primary_culture = cu:yue
		}
		any_scope_state = {
			any_neighbouring_state = {
				is_treaty_port = yes
			}
		}
		has_technology_researched = socialism
		has_law = law_type:law_right_of_assembly
		NOT = {
			has_global_variable = may_4_movement_var
		}
	}
	immediate = {
		every_scope_state = {
			random_neighbouring_state = {
				limit = {
					is_treaty_port = yes
				}
				save_scope_as = target_treaty_port
			}
		}
		scope:target_treaty_port = {
			controller = {
				save_scope_as = target_treaty_port_controller
			}
		}
		set_global_variable = may_4_movement_var
		set_variable = may_4_movement_target
		add_modifier = {
			name = modifier_great_assembly
			years = 1.5
			is_decaying = yes
		}
	}
	option = {
		name = moh_historical.1.a
		scope:target_treaty_port_controller = {
			trigger_event = {
				id = moh_historical.2
			}
		}
		change_relations = {
			country = scope:target_treaty_port_controller
			value = -25
		}
		show_as_tooltip = {
			add_modifier = {
				name = modifier_great_assembly
				years = 1.5
				is_decaying = yes
			}
		}
		ai_chance = {
			base = 25
		}
	}
	option = {
		name = moh_historical.1.b
		default_option = yes
		change_relations = {
			country = scope:target_treaty_port_controller
			value = 25
		}
		show_as_tooltip = {
			add_modifier = {
				name = modifier_great_assembly
				years = 1.5
				is_decaying = yes
			}
		}
		ai_chance = {
			base = 20
		}
	}
}

moh_historical.2 = {
	type = country_event
	placement = root
	title = moh_historical.2.t
	desc = moh_historical.2.d
	flavor = moh_historical.2.f
	dlc = dlc0moh
	event_image = {
		video = "asia_protest"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/event_icons/event_scales.dds"
	duration = 3
	trigger = {
		has_global_variable = may_4_movement_var
	}
	immediate = {
		random_country = {
			limit = {
				has_variable = may_4_movement_target
			}
			save_scope_as = target_country
		}
	}
	option = {
		name = moh_historical.2.a
		scope:target_treaty_port = {
			set_state_owner = scope:target_country
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 20
				trigger = {
					scope:target_country.army_power_projection >= root.army_power_projection
				}
			}
			modifier = {
				add = 20
				trigger = {
					scope:target_country.country_rank = rank_value:great_power
				}
			}
		}
	}
	option = {
		name = moh_historical.2.b
		default_option = yes
		scope:target_country = {
			trigger_event = {
				id = moh_historical.3
			}
		}
		ai_chance = {
			base = 10
		}
	}
}

moh_historical.3 = {
	type = country_event
	placement = root
	title = moh_historical.3.t
	desc = moh_historical.3.d
	flavor = moh_historical.3.f
	dlc = dlc0moh
	event_image = {
		video = "europenorthamerica_before_the_battle"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/event_icons/event_scales.dds"
	duration = 3
	trigger = {
		has_global_variable = may_4_movement_var
	}
	immediate = {
		random_country = {
			limit = {
				has_variable = may_4_movement_target
			}
			save_scope_as = target_country
		}
	}
	option = {
		name = moh_historical.3.a
		create_diplomatic_play = {
			target_country = scope:target_treaty_port_controller
			target_state = scope:target_treaty_port
			type = dp_take_treaty_port
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 20
				trigger = {
					scope:target_country.army_power_projection >= root.army_power_projection
				}
			}
			modifier = {
				add = 20
				trigger = {
					scope:target_country.country_rank = rank_value:great_power
				}
			}
		}
	}
	option = {
		name = moh_historical.3.b
		default_option = yes
		add_radicals = {
			value = small_radicals
			pop_type = academics
		}
		add_radicals = {
			value = small_radicals
			pop_type = laborers
		}
		ai_chance = {
			base = 10
		}
	}
}

moh_historical.4 = {
	# Arrow Incident
	type = country_event
	placement = root
	title = moh_historical.4.t
	desc = moh_historical.4.d
	flavor = moh_historical.4.f
	dlc = dlc0moh
	event_image = {
		video = "asia_westerners_arriving"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/formation_order_icons/station_fleet.dds"
	duration = 3
	trigger = {
		OR = {
			has_variable = lost_opium_wars
			AND = {
				has_variable = china_warlord_explosion
				var:china_warlord_explosion <= 4
			}
		}
		any_scope_state = {
			any_neighbouring_state = {
				is_treaty_port = yes
				controller = c:GBR
			}
		}
		NOT = {
			has_law = law_type:law_isolationism
		}
		NOT = {
			has_truce_with = c:GBR
		}
		NOT = {
			has_war_with = c:GBR
		}
		NOT = {
			has_variable = arrow_incident_begins
		}
		NOT = {
			c:GBR = {
				has_diplomatic_pact = {
					who = c:CHI
					type = foreign_investment_rights
				}
			}
		}
	}
	immediate = {
		every_scope_state = {
			random_neighbouring_state = {
				limit = {
					is_treaty_port = yes
					controller = c:GBR
				}
				save_scope_as = target_treaty_port
			}
		}
		c:GBR = {
			save_scope_as = arrow_country
		}
		set_variable = arrow_incident_begins
	}
	option = {
		name = moh_historical.4.a
		c:GBR = {
			trigger_event = {
				id = moh_historical.5
			}
		}
		custom_tooltip = moh_historical.4.a_tt
		set_variable = arrow_war_target
		ai_chance = {
			base = 50
		}
	}
	option = {
		name = moh_historical.4.b
		default_option = yes
		activate_law = law_type:law_migration_controls
		custom_tooltip = {
			text = moh_historical.4.b_tt
			c:GBR = {
				create_diplomatic_pact = {
					country = c:CHI
					type = foreign_investment_rights
				}
			}
		}
		set_variable = arrow_incident_failed
		add_modifier = {
			name = flood_of_pirates
			months = 24
			is_decaying = yes
		}
		if = {
			limit = {
				scope:arrow_country = {
					relations:root <= relations_threshold:poor
				}
			}
			change_relations = {
				country = c:GBR
				value = 50
			}
		}
		else_if = {
			limit = {
				scope:arrow_country = {
					relations:root > relations_threshold:poor
				}
			}
			change_relations = {
				country = c:GBR
				value = 25
			}
		}
		else = {
			change_relations = {
				country = c:GBR
				value = 5
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 20
				trigger = {
					c:GBR.army_power_projection >= root.army_power_projection
				}
			}
		}
	}
}

moh_historical.5 = {
	# Arrow Incident British
	type = country_event
	placement = root
	title = moh_historical.5.t
	desc = moh_historical.5.d
	flavor = moh_historical.5.f
	dlc = dlc0moh
	event_image = {
		video = "asia_westerners_arriving"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/formation_order_icons/station_fleet.dds"
	duration = 3
	immediate = {
		random_country = {
			limit = {
				has_variable = arrow_war_target
			}
			save_scope_as = arrow_target_country
		}
	}
	option = {
		name = moh_historical.5.a
		scope:arrow_target_country = {
			set_secret_goal = {
				country = root
				secret_goal = antagonize
			}
		}
		set_secret_goal = {
			country = scope:arrow_target_country
			secret_goal = conquer
		}
		# create_diplomatic_play = {
		# 	type = dp_give_foreign_investment_rights
		# 	target_country = scope:arrow_target_country
		# 	is_war = no
		# }
		hidden_effect = {
			c:FRA = {
				trigger_event = {
					id = moh_historical.7
				}
			}
		}
		ai_chance = {
			base = 80
		}
	}
	option = {
		name = moh_historical.5.b
		default_option = yes
		scope:arrow_target_country = {
			remove_variable = arrow_war_target
		}
		change_relations = {
			country = scope:arrow_target_country
			value = 25
		}
		ai_chance = {
			base = 10
		}
	}
}

moh_historical.6 = {
	# arrow incident failure
	type = country_event
	placement = root
	title = moh_historical.6.t
	desc = moh_historical.6.d
	flavor = moh_historical.6.f
	dlc = dlc0moh
	event_image = {
		video = "europenorthamerica_political_extremism"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/formation_order_icons/station_fleet.dds"
	duration = 3
	trigger = {
		NOT = {
			has_variable = arrow_incident_failed
		}
		has_variable = arrow_war_target
		OR = {
			c:GBR = {
				has_diplomatic_pact = {
					who = c:CHI
					type = foreign_investment_rights
				}
			}
			c:FRA = {
				has_diplomatic_pact = {
					who = c:CHI
					type = foreign_investment_rights
				}
			}
		}
	}
	immediate = {
		remove_variable = arrow_war_target
		set_variable = arrow_incident_failed
		if = {
			limit = {
				c:FRA = {
					has_diplomatic_pact = {
						who = c:CHI
						type = foreign_investment_rights
					}
				}
			}
			c:FRA = {
				save_scope_as = arrow_country
			}
		}
		if = {
			limit = {
				c:GBR = {
					has_diplomatic_pact = {
						who = c:CHI
						type = foreign_investment_rights
					}
				}
			}
			c:GBR = {
				save_scope_as = arrow_country
			}
		}
	}
	option = {
		name = moh_historical.6.a
		default_option = yes
		activate_law = law_type:law_migration_controls
		ai_chance = {
			base = 50
		}
	}
}

moh_historical.7 = {
	# Arrow Incident French
	type = country_event
	placement = root
	title = moh_historical.7.t
	desc = moh_historical.7.d
	flavor = moh_historical.7.f
	dlc = dlc0moh
	event_image = {
		video = "asia_westerners_arriving"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/formation_order_icons/station_fleet.dds"
	duration = 3
	immediate = {
		random_country = {
			limit = {
				has_variable = arrow_war_target
			}
			save_scope_as = arrow_target_country
		}
		c:GBR = {
			save_scope_as = arrow_country
		}
	}
	option = {
		name = moh_historical.7.a
		scope:arrow_target_country = {
			set_secret_goal = {
				country = root
				secret_goal = antagonize
			}
		}
		set_secret_goal = {
			country = scope:arrow_target_country
			secret_goal = conquer
		}
		ai_chance = {
			base = 50
		}
	}
	option = {
		name = moh_historical.7.b
		default_option = yes
		change_relations = {
			country = scope:arrow_target_country
			value = 25
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 50
				trigger = {
					relations:root >= relations_threshold:friendly
				}
			}
		}
	}
}

moh_historical.8 = {
	# old summer palace
	type = country_event
	placement = root
	title = moh_historical.8.t
	desc = moh_historical.8.d
	flavor = moh_historical.8.f
	dlc = dlc0moh
	event_image = {
		video = "unspecific_fire"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	icon = "gfx/interface/icons/timed_modifier_icons/modifier_fire_negative.dds"
	duration = 3
	trigger = {
		has_variable = old_summer_palace
		has_variable = arrow_war_target
		OR = {
			s:STATE_BEIJING.region_state:CHI.controller = c:FRA
			s:STATE_BEIJING.region_state:CHI.controller = c:GBR
		}
		is_at_war = yes
	}
	immediate = {
		remove_variable = old_summer_palace
		s:STATE_BEIJING.region_state:CHI = {
			save_scope_as = old_summer_palace_state_scope
			random_scope_building = {
				limit = {
					is_building_type = building_old_summer_palace
				}
				save_scope_as = old_summer_palace_scope
			}
			if = {
				limit = {
					has_building = building_old_summer_palace
				}
				remove_building = building_old_summer_palace
			}
		}
		if = {
			limit = {
				any_scope_character = {
					has_template = chi_xianfeng_template
				}
			}
			random_scope_character = {
				limit = {
					has_template = chi_xianfeng_template
				}
				save_scope_as = xianfeng_character
			}
		}
	}
	option = {
		name = moh_historical.8.a
		default_option = yes
		custom_tooltip = moh_historical.8.a_tt
		s:STATE_BEIJING = {
			add_devastation = 5
		}
		if = {
			limit = {
				ruler = {
					has_template = chi_xianfeng_template
				}
			}
			custom_tooltip = moh_historical.8.a_tt_emperor
		}
		if = {
			limit = {
				heir = {
					has_template = chi_xianfeng_template
				}
			}
			custom_tooltip = moh_historical.8.a_tt_heir
		}
		ai_chance = {
			base = 50
		}
	}
}

moh_historical.9 = {
	# Destruction of opium at Humen
	type = country_event
	placement = scope:guangdong_state_scope
	title = moh_historical.9.t
	desc = moh_historical.9.d
	flavor = moh_historical.9.f
	dlc = dlc0moh
	event_image = {
		video = "unspecific_temperance_movement"
	}
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/qing_hat.dds"
	duration = 3
	trigger = {
		NOT = {
			has_variable = destruction_of_opium
		}
		any_scope_character = {
			has_variable = is_linzexu
		}
		has_state_in_state_region = STATE_GUANGDONG
	}
	immediate = {
		set_variable = destruction_of_opium
		random_scope_character = {
			limit = {
				has_variable = is_linzexu
			}
			save_scope_as = linzexu_character
		}
		random_scope_state = {
			limit = {
				state_region = s:STATE_GUANGDONG
			}
			save_scope_as = guangdong_state_scope
		}
	}
	option = {
		name = moh_historical.9.a
		default_option = yes
		custom_tooltip = moh_historical.9.a_tt
		change_relations = {
			country = c:GBR
			value = -25
		}
	}
}

moh_historical.10 = {
	# death of sun yat-sen
	type = country_event
	placement = root
	title = moh_historical.10.t
	desc = moh_historical.10.d
	flavor = moh_historical.10.f
	dlc = dlc0moh
	gui_window = event_window_1char_tabloid
	left_icon = scope:sun_yatsen_dead_scope
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"
	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	duration = 3

	trigger = {
		has_global_variable = sun_yatsen
		NOT = {
			has_global_variable = sun_yatsen_dead
		}
		year >= 1924
	}

	immediate = {
		global_var:sun_yatsen = {
			save_scope_as = sun_yatsen_dead_scope
		}
		set_global_variable = sun_yatsen_dead
	}

	option = {
		name = moh_historical.10.a
		default_option = yes
		highlighted_option = yes
		trigger = {
			custom_tooltip = {
				text = sun_yatsen_dead_tt
			}
		}
		scope:sun_yatsen_dead_scope = {
			kill_character = yes
		}
		remove_global_variable = sun_yatsen
		ai_chance = {
			base = 10
		}
	}
}