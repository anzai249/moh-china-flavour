support_shih_chin_pai_button = {
	name = "support_shih_chin_pai"
	desc = "support_shih_chin_pai_desc"
	visible = {
		OR = {
			has_journal_entry = je_daoguang_reform_opium
		}
	}
	possible = {
		custom_tooltip = {
			text = je_daoguang_reform_opium_not_cooldown_tt
			NOT = {
				has_variable = je_daoguang_reform_opium_cooldown
			}
		}
		custom_tooltip = {
			text = je_daoguang_reform_opium_already_support_tt
			NOT = {
				has_variable = supporting_shih_chin_pai_var
			}
		}
	}
	selected = {
		has_variable = supporting_shih_chin_pai_var
	}
	effect = {
		custom_tooltip = {
			text = supporting_shih_chin_pai_tt
			set_variable = supporting_shih_chin_pai_var
			set_variable = {
				name = je_daoguang_reform_opium_cooldown
				months = 3
			}
			remove_variable = supporting_yen_chin_pai_var
		}
	}
}

support_yen_chin_pai_button = {
	name = "support_yen_chin_pai"
	desc = "support_yen_chin_pai_desc"
	visible = {
		OR = {
			has_journal_entry = je_daoguang_reform_opium
		}
	}
	possible = {
		custom_tooltip = {
			text = je_daoguang_reform_opium_not_cooldown_tt
			NOT = {
				has_variable = je_daoguang_reform_opium_cooldown
			}
		}
		custom_tooltip = {
			text = je_daoguang_reform_opium_already_support_tt
			NOT = {
				has_variable = supporting_yen_chin_pai_var
			}
		}
	}
	selected = {
		has_variable = supporting_yen_chin_pai_var
	}
	effect = {
		custom_tooltip = {
			text = supporting_yen_chin_pai_tt
			set_variable = supporting_yen_chin_pai_var
			set_variable = {
				name = je_daoguang_reform_opium_cooldown
				months = 3
			}
			remove_variable = supporting_shih_chin_pai_var
		}
	}
}

REPLACE:ban_opium_button = {
	name = "ban_opium"
	desc = "ban_opium_desc"
	visible = {
		OR = {
			has_journal_entry = je_opium_obsession
			has_journal_entry = je_opium_communism
		}
		exists = market
		market.owner = root
		NOT = {
			is_banning_goods = g:opium
		}
	}
	possible = {
		OR = {
			has_journal_entry = je_opium_obsession
			has_journal_entry = je_opium_communism
		}
		NOT = {
			has_law = law_type:law_free_trade
		}
		custom_tooltip = {
			text = not_lost_opium_wars_tt
			NOT = {
				has_variable = lost_opium_wars
			}
		}
		exists = market
		OR = {
			AND = {
				c:CHI ?= this
				OR = {
					custom_tooltip = {
						text = yen_chin_pai_victory_tt
						has_variable = opium_yen_chin_pai_victory
					}
					has_law = law_type:law_council_republic
				}
			}
			AND = {
				NOT = {
					c:CHI ?= this
				}
				NOT = {
					custom_tooltip = {
						text = yen_chin_pai_victory_tt
						has_variable = opium_yen_chin_pai_victory
					}
				}
			}
		}
	}
	effect = {
		add_banned_goods = g:opium
		if = {
			limit = {
				NOT = {
					has_law = law_type:law_council_republic
				}
			}
			trigger_event = {
				id = moh_historical.9
				popup = yes
			}
		}
		add_modifier = {
			name = opium_ban_authority
		}
	}
	ai_chance = {
		value = 0
		if = {
			limit = {
				OR = {
					has_strategy = ai_strategy_conservative_agenda
					has_strategy = ai_strategy_reactionary_agenda
					has_strategy = ai_strategy_maintain_mandate_of_heaven
				}
			}
			add = 10
		}
	}
}

REPLACE:unban_opium_button = {
	name = "remove_opium_ban"
	desc = "remove_opium_ban_desc"
	visible = {
		OR = {
			has_journal_entry = je_opium_obsession
			has_journal_entry = je_opium_communism
		}
		is_banning_goods = g:opium
		exists = market
		market.owner = root
	}
	possible = {
		always = yes
	}
	effect = {
		remove_banned_goods = g:opium
		remove_modifier = opium_ban_authority
	}
	ai_chance = {
		value = 0
		if = {
			limit = {
				has_strategy = ai_strategy_progressive_agenda
			}
			add = 10
		}
	}
}

legalize_opium_button = {
	name = "legalize_opium"
	desc = "legalize_opium_desc"
	visible = {
		has_journal_entry = je_opium_obsession
		exists = market
		market.owner = root
		NOT = {
			is_banning_goods = g:opium
		}
	}
	possible = {
		has_journal_entry = je_opium_obsession
		custom_tooltip = {
			text = not_lost_opium_wars_tt
			NOT = {
				has_variable = lost_opium_wars
			}
		}
		exists = market
		OR = {
			AND = {
				c:CHI ?= this
				custom_tooltip = {
					text = shih_chin_pai_victory_tt
					has_variable = opium_shih_chin_pai_victory
				}
			}
			AND = {
				NOT = {
					c:CHI ?= this
				}
				NOT = {
					custom_tooltip = {
						text = shih_chin_pai_victory_tt
						has_variable = opium_shih_chin_pai_victory
					}
				}
			}
		}
	}
	effect = {
		hidden_effect = { remove_modifier = opium_wars_addiction_modifier }
		set_variable = shih_chin_legalized_opium
		set_import_tariff_level = {
			goods = g:opium
			level = max_tariffs
		}
		add_modifier = {
			name = opium_wars_addiction_shih_chin_modifier
			days = long_modifier_time
		}
		add_journal_entry = {
			type = je_shih_chin_opium
		}
		change_relations = {
			country = c:GBR
			value = -30
		}
	}
	ai_chance = {
		value = 0
		if = {
			limit = {
				OR = {
					has_strategy = ai_strategy_conservative_agenda
					has_strategy = ai_strategy_reactionary_agenda
					has_strategy = ai_strategy_maintain_mandate_of_heaven
				}
			}
			add = 10
		}
	}
}
