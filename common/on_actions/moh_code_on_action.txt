# Root = Character
on_new_ruler = {
	effect = {
		if = {
			limit = {
				owner = {
					NOT = {
						has_variable = hide_ruler_change_notification
					}
				}
			}
			post_notification = new_ruler
		}
		# if = {
		# 	limit = {
		# 		owner = {
		# 			c:CHI ?= this
		# 			has_law = law_type:law_monarchy
		# 		}
		# 		is_ruler = yes
		# 	}
		# 	if = {
		# 		limit = {
		# 			has_template = moh_chi_daoguang_template
		# 		}
		# 		owner = {
		# 			trigger_event = { id = qing_monarchy.1 popup = yes }
		# 		}
		# 	}
		# }
		if = {
			limit = {
				owner = {
					c:RUS ?= this
					has_law = law_type:law_monarchy
				}
				is_ruler = yes
			}
			if = {
				limit = {
					has_template = RUS_alexander_ii
				}
				owner = {
					trigger_event = { id = russia_monarchy.1 popup = yes }
				}
			}
			else_if = {
				limit = {
					has_template = RUS_tsarevich_nicholas_alexandrovich
				}
				owner = {
					trigger_event = { id = russia_monarchy.3 popup = yes }
				}
			}
			else_if = {
				limit = {
					has_template = RUS_alexander_iii
				}
				owner = {
					trigger_event = { id = russia_monarchy.4 popup = yes }
				}
			}
			else_if = {
				limit = {
					has_template = RUS_nicholas_ii
				}
				owner = {
					trigger_event = { id = russia_monarchy.5 popup = yes }
				}
			}
			else_if = {
				limit = {
					has_template = RUS_alexei_ii
				}
				owner = {
					trigger_event = { id = russia_monarchy.9 popup = yes }
				}
			}
			else_if = {
				limit = {
					has_template = RUS_michael_ii
				}
				owner = {
					trigger_event = { id = russia_monarchy.10 popup = yes }
				}
			}
			else_if = {
				limit = {
					has_template = RUS_george_i
				}
				owner = {
					trigger_event = { id = russia_monarchy.11 popup = yes }
				}
			}
		}
		if = {
			limit = {
				owner = {
					c:PRG ?= this
				}
				has_template = PRG_francisco_solano_lopez
				is_ruler = yes
			}
			owner = {
				random_scope_character = {
					limit = {
						has_template = PRG_francisco_solano_lopez
					}
					if = {
						limit = {
							has_modifier = napoleon_of_the_americas_modifier
						}
						remove_modifier = napoleon_of_the_americas_modifier
					}
					add_modifier = {
						name = napoleon_of_the_americas_modifier
						multiplier = 2
					}
				}
			}
		}
	}
}

# Root = Country
on_monthly_pulse_country = {
	events = {
		communism.8 # Red Army
		peoples_springtime.1
		opium_wars.1
		native_resettlement.1
		meiji.13
		bic_breakup.1
		dreyfus.1
		dei_breakup.1
		poland_events.3 # Polish Unification
		colonial_administration_events.2 # African Colony Radicals
		caudillo.1
		sa_migration.5
		amazonas.1 # Taming Amazonia
		paraguay.11 # Paraguay War
		acw_events.9 # CSA victory event
		persia_events.5 # Persian slave liberation event

		# Exile Agitators Events
		yeet_agitator_events.1
		yeet_agitator_events.2
		yeet_agitator_events.3

		# Comte
		positivism.1

		# Milyutin
		caucasuswar.5
	}
	effect = {
		trigger_event = { id = unable_to_enact.1 }

		### This is how we give objectives to AI countries
		if = {
			limit = {
				has_journal_entry = je_great_game_control
				has_dlc_feature = ep1_content
				is_player = no
			}
			if = {
				limit = {
					c:RUS ?= this
				}
				### Generic Objectives
				if = {
					limit = {
						NOT = {
							has_variable = je_tibet_expedition_ai_var
						}
						has_variable = tibet_has_started
						NOT = { has_global_variable = tibet_expedition_completed }
						has_interest_marker_in_region = region_himalayas
					}
					set_variable = je_tibet_expedition_ai_var
					add_journal_entry = {
						type = je_tibet_expedition
					}
				}
				if = {
					limit = {
						NOT = {
							has_variable = je_consolidate_afghanistan_objective_ai_var
						}
						has_interest_marker_in_region = region_persia
						exists = c:AFG
					}
					set_variable = je_consolidate_afghanistan_objective_ai_var
					add_journal_entry = {
						type = je_consolidate_afghanistan_objective
					}
				}
				if = {
					limit = {
						NOT = {
							has_variable = je_maintain_afghan_protectorate_ai_var
						}
						NOT = {
							has_global_variable = gg_afghanistan_protectorate_done
						}
						has_interest_marker_in_region = region_persia
					}
					set_variable = je_maintain_afghan_protectorate_ai_var
					add_journal_entry = {
						type = je_maintain_afghan_protectorate
					}
				}
				if = {
					limit = {
						NOT = {
							has_variable = je_secure_influence_over_persia_ai_var
						}
						has_interest_marker_in_region = region_persia
					}
					set_variable = je_secure_influence_over_persia_ai_var
					add_journal_entry = {
						type = je_secure_influence_over_persia
					}
				}

				### Specific Objectives
				if = {
					limit = {
						NOT = {
							has_variable = je_secure_persian_border_ai_var
						}
						exists = c:CIR
					}
					set_variable = je_secure_persian_border_ai_var
					add_journal_entry = {
						type = je_secure_persian_border
					}
				}
				if = {
					limit = {
						NOT = {
							has_variable = je_pacify_kazakh_steppes_ai_var
						}
						has_journal_entry = je_pacify_the_steppes
					}
					set_variable = je_pacify_kazakh_steppes_ai_var
					add_journal_entry = {
						type = je_pacify_kazakh_steppes
					}
				}
				if = {
					limit = {
						NOT = {
							has_variable = je_codify_chinese_border_ai_var
						}
						has_technology_researched = nationalism
					}
					set_variable = je_codify_chinese_border_ai_var
					add_journal_entry = {
						type = je_codify_chinese_border
					}
				}
				if = {
					limit = {
						NOT = {
							has_variable = je_consolidate_central_asia_ai_var
						}
						has_technology_researched = nationalism
					}
					set_variable = je_consolidate_central_asia_ai_var
					add_journal_entry = {
						type = je_consolidate_central_asia
					}
				}
				if = {
					limit = {
						NOT = {
							has_variable = je_chinese_concessions_ai_var
						}
						has_technology_researched = railways
						any_scope_state = {
							OR = {
								state_region = s:STATE_OUTER_MANCHURIA
								state_region = s:STATE_AMUR
							}
							is_incorporated = yes
						}
					}
					set_variable = je_chinese_concessions_ai_var
					add_journal_entry = {
						type = je_chinese_concessions
					}
				}
				if = {
					limit = {
						NOT = {
							has_variable = je_acquire_korean_protectorate_ai_var
						}
						any_neighbouring_state = {
							owner = c:KOR
							is_incorporated = yes
						}
						c:KOR ?= {
							is_country_type = unrecognized
						}
					}
					set_variable = je_acquire_korean_protectorate_ai_var
					add_journal_entry = {
						type = je_acquire_korean_protectorate
					}
				}
			}
			
			if = {
				limit = {
					c:GBR ?= this
					has_journal_entry = je_great_game_control
				}
				### Generic Objectives
				if = {
					limit = {
						NOT = {
							has_variable = je_tibet_expedition_ai_var
						}
						has_variable = tibet_has_started
						NOT = { has_global_variable = tibet_expedition_completed }
						has_interest_marker_in_region = region_himalayas
					}
					set_variable = je_tibet_expedition_ai_var
					add_journal_entry = {
						type = je_tibet_expedition
					}
				}
				if = {
					limit = {
						NOT = {
							has_variable = je_consolidate_afghanistan_objective_ai_var
						}
						has_interest_marker_in_region = region_persia
						exists = c:AFG
					}
					set_variable = je_consolidate_afghanistan_objective_ai_var
					add_journal_entry = {
						type = je_consolidate_afghanistan_objective
					}
				}
				if = {
					limit = {
						NOT = {
							has_variable = je_maintain_afghan_protectorate_ai_var
						}
						NOT = {
							has_global_variable = gg_afghanistan_protectorate_done
						}
						has_interest_marker_in_region = region_persia
					}
					set_variable = je_maintain_afghan_protectorate_ai_var
					add_journal_entry = {
						type = je_maintain_afghan_protectorate
					}
				}
				if = {
					limit = {
						NOT = {
							has_variable = je_secure_influence_over_persia_ai_var
						}
						has_interest_marker_in_region = region_persia
					}
					set_variable = je_secure_influence_over_persia_ai_var
					add_journal_entry = {
						type = je_secure_influence_over_persia
					}
				}
				### Specific Objectives
				if = {
					limit = {
						NOT = {
							has_variable = je_disrupt_russian_caucasus_ai_var
						}
						exists = c:CIR
					}
					set_variable = je_disrupt_russian_caucasus_ai_var
					add_journal_entry = {
						type = je_disrupt_russian_caucasus
					}
				}
				if = {
					limit = {
						NOT = {
							has_variable = je_counter_russian_pacific_influence_ai_var
						}
						c:RUS ?= {
							any_scope_state = {
								region = sr:region_manchuria
								OR = {
									any_scope_building = {
										is_building_type = building_port
										level >= 5
									}
									any_scope_building = {
										is_building_type = building_naval_base
										level >= 15
									}
								}
							}
						}
					}
					set_variable = je_counter_russian_pacific_influence_ai_var
					add_journal_entry = {
						type = je_counter_russian_pacific_influence
					}
				}
				if = {
					limit = {
						NOT = {
							has_variable = je_consolidate_british_india_ai_var
						}
						c:BIC ?= {
							is_subject_of = c:GBR
						}
					}
					set_variable = je_consolidate_british_india_ai_var
					add_journal_entry = {
						type = je_consolidate_british_india
					}
				}
				if = {
					limit = {
						NOT = {
							has_variable = je_pamir_expedition_objective_ai_var
						}
						c:RUS ?= {
							OR = {
								any_scope_state = {
									state_region = s:STATE_TAJIKISTAN
								}
								any_subject_or_below = {
									any_scope_state = {
										state_region = s:STATE_TAJIKISTAN
									}
								}
							}
						}
						NOT = {
							has_variable = dismissed_pamir_expedition
						}
					}
					set_variable = je_pamir_expedition_objective_ai_var
					add_journal_entry = {
						type = je_pamir_expedition_objective
					}
				}
			}
			
			if = {
				limit = {
					is_afghan_nation = yes
					has_journal_entry = je_great_game_control
				}
				### Generic Objectives
				if = {
					limit = {
						NOT = {
							has_variable = je_achieve_sovereignty_ai_var
						}
						is_country_type = unrecognized
					}
					set_variable = je_achieve_sovereignty_ai_var
					add_journal_entry = {
						type = je_achieve_sovereignty
					}
				}
				### Specific Objectives
				if = {
					limit = {
						NOT = {
							has_variable = je_unify_afghanistan_objective_ai_var
						}
					}
					set_variable = je_unify_afghanistan_objective_ai_var
					add_journal_entry = {
						type = je_unify_afghanistan_objective
					}
				}
			}
			
			if = {
				limit = {
					c:PER ?= this
					has_journal_entry = je_great_game_control
				}
				### Generic Objectives
				if = {
					limit = {
						NOT = {
							has_variable = je_achieve_sovereignty_ai_var
						}
						is_country_type = unrecognized
					}
					set_variable = je_achieve_sovereignty_ai_var
					add_journal_entry = {
						type = je_achieve_sovereignty
					}
				}
				### Specific Objectives
				if = {
					limit = {
						NOT = {
							has_variable = je_consolidate_persia_ai_var
						}
					}
					set_variable = je_consolidate_persia_ai_var
					add_journal_entry = {
						type = je_consolidate_persia
					}
				}
			}
		}
		
		# TODO: Move these to tag-specific pulses
		if = {
			limit = {
				this = c:FRA
				c:FRA ?= {
					OR = {
						has_modifier = modifier_haitian_independence_payments_1
						has_modifier = modifier_haitian_independence_payments_2
						has_modifier = modifier_haitian_independence_payments_3
						has_modifier = modifier_haitian_independence_payments_4
					}
				}
				NOT = { exists = c:HAI }
			}
			c:FRA = {
				if = {
					limit = {
						has_modifier = modifier_haitian_independence_payments_1
					}
					remove_modifier = modifier_haitian_independence_payments_1
				}
				if = {
					limit = {
						has_modifier = modifier_haitian_independence_payments_2
					}
					remove_modifier = modifier_haitian_independence_payments_2 
				}
				if = {
					limit = {
						has_modifier = modifier_haitian_independence_payments_3
					}
					remove_modifier = modifier_haitian_independence_payments_3
				}
				if = {
					limit = {
						has_modifier = modifier_haitian_independence_payments_4
					}
					remove_modifier = modifier_haitian_independence_payments_4
				}
			}
		}
		if = { #Exists to make sure independent Perus get this ASAP.
			limit = {
				OR = {
					c:NPU ?= this
					c:SPU ?= this
				}
				is_subject = no
				NOT = {
					has_variable = peru_has_claims
				}
				OR = {
					AND = { #SPU is either dead or a puppet, will not fire if it is independent.
						c:NPU ?= this
						OR = {
							NOT = {
								exists = c:SPU
							}
							c:SPU ?= { is_subject = yes }
						}
					}
					AND = {
						c:SPU ?= this
						OR = {
							NOT = {
								exists = c:SPU
							}
							c:NPU ?= { is_subject = yes }
						}
					}
				}
			}
			trigger_event = { id = peru_bolivia_events.8 days = 0 popup = yes }
		}

		if = {
			limit = {
				NOT = {
					has_variable = cant_touch_this_achievement_possible
				}
				any_country = {
					NOT = {
					   THIS = ROOT
					}
					ROOT = {
						"gdp_ownership_ratio(prev)" > 0.10
					}	
			    }
			}
			set_variable = cant_touch_this_achievement_possible
		}
	}
	on_actions = { # delay ensures events won't fire simultaneously
		coup_monthly_events
		delay = { days = 4 }
		garibaldi_monthly_events
		delay = { days = 7 }
		fund_lobbies_monthly_events
	}
}

on_yearly_pulse_country = {
	effect = {
		# IG leader death
		random_list = {
			1 = {
				trigger_event = { id = character_events.100 }
			}
			1 = { }
		}		
		
		# Countries have a chance to change their mind about who they want to support in Egypt vs Ottomans conflicts
		if = {
			limit = {
				has_variable = veiled_protectorate_support_ottomans
			}
			
			random_list = {
				95 = {}
				3 = { 
					remove_variable = veiled_protectorate_support_ottomans 
				}
				2 = { 
					remove_variable = veiled_protectorate_support_ottomans 
					set_variable = veiled_protectorate_support_egypt
				}
			}
		}
		else_if = {
			limit = {
				has_variable = veiled_protectorate_support_egypt
			}
			
			random_list = {
				95 = {}
				3 = { 
					remove_variable = veiled_protectorate_support_egypt
				}
				2 = { 
					remove_variable = veiled_protectorate_support_egypt
					set_variable = veiled_protectorate_support_ottomans
				}
			}
		}				

		if = {
			limit = {
				NOR = {
					has_journal_entry = je_sick_man_main # Ottomans have enough required reforms to worry about
					has_journal_entry = je_meiji_restoration # Ditto for Japan
					has_variable = gov_petition_fired
					has_variable = gov_petition_cooldown
					has_modifier = modifier_successfully_met_petition_legitimacy
					any_interest_group = {
						has_modifier = modifier_failed_to_meet_petition
					}
					has_journal_entry = je_government_petition
					is_revolutionary = yes
					is_secessionist = yes
				}
				ig_desires_laws_for_petition = yes
			}
			if = {
				limit = {
					has_variable = gov_petition_coin_toss
				}
				random_list = {
					1 = { 
						set_variable = { name = gov_petition_cooldown years = 10 }
						set_variable = { name = gov_petition_fired months = 3 }
						trigger_event = { id = government_petition_events.1 }
					}
					1 = {
	
					}
				}
				remove_variable = gov_petition_coin_toss
			}
			else = {
				random_list = {
					1 = { 
						set_variable = { name = gov_petition_cooldown years = 10 }
						set_variable = { name = gov_petition_fired months = 3 }
						trigger_event = { id = government_petition_events.1 }
					}
					9 = {
	
					}
				}
			}
		}

		if = {
			limit = {
				ROOT = {
					is_player = yes
					has_dlc_feature = voice_of_the_people_content
					empty_agitator_slots >= 1
					OR = {
						c:USA ?= this
						trigger_if = {
							limit = {
								exists = c:CAL
							}
							c:CAL ?= this
						}
					}
					any_scope_state = {
						state_region = s:STATE_CALIFORNIA
						is_incorporated = yes
					}
					game_date > 1860.1.1
					game_date < 1880.1.1
				}
				NOT = { has_global_variable = emperor_norton_spawn }	
			}
			trigger_event = { id = historical_agitators.9 }
		}

		# Achievement: For Twelve Years You Have Been Asking
		if = {
			limit = {
				any_scope_building = {
					NOR = {
						is_building_group = bg_government
						is_building_group = bg_construction
						is_building_group = bg_military
						is_building_group = bg_urban_facilities
						is_building_group = bg_canals
					}
					level > 0
					private_ownership_fraction = 1
				}
				NOT = {
					has_variable = achievement_for_twelve_years_you_have_been_asking_timed
					has_variable = achievement_for_twelve_years_you_have_been_asking
				}
			}
			set_variable = {
				name = achievement_for_twelve_years_you_have_been_asking_timed
				years = 12
			}
			set_variable = {
				name = achievement_for_twelve_years_you_have_been_asking
			}
		}
		else_if = {
			limit = {
				any_scope_building = {
					NOR = {
						is_building_group = bg_government
						is_building_group = bg_construction
						is_building_group = bg_military
						is_building_group = bg_urban_facilities
						is_building_group = bg_canals
					}
					level > 0
					private_ownership_fraction < 1
				}
				OR = {
					has_variable = achievement_for_twelve_years_you_have_been_asking_timed
					has_variable = achievement_for_twelve_years_you_have_been_asking
				}
			}
			# RESET THE CLOCK

			remove_variable = achievement_for_twelve_years_you_have_been_asking
			remove_variable = achievement_for_twelve_years_you_have_been_asking_timed
		}

		# Achievement: Can't Touch This
		if = {
			limit = {
				any_scope_building = {
					level > 0
					private_ownership_fraction = 0
				}
				NOT = {
					has_variable = achievement_cant_touch_this_timed
					has_variable = achievement_cant_touch_this
				}
			}
			set_variable = {
				name = achievement_cant_touch_this_timed
				years = 12
			}
			set_variable = {
				name = achievement_cant_touch_this
			}
		}
		else_if = {
			limit = {
				any_scope_building = {
					level > 0
					private_ownership_fraction > 0
					NOR = {
						is_building_group = bg_subsistence_ranching
						is_building_group = bg_subsistence_agriculture
						is_building_group = bg_gold_fields
					}
				}
				OR = {
					has_variable = achievement_cant_touch_this_timed
					has_variable = achievement_cant_touch_this
				}
			}
			# RESET THE CLOCK

			remove_variable = achievement_cant_touch_this
			remove_variable = achievement_cant_touch_this_timed
		}
	}
	on_actions = { # delay ensures events won't fire simultaneously
		on_yearly_events
		delay = { days = 1 }
		russian_monarchy_yearly_events
		delay = { days = 1 }
		springtime_of_peoples_yearly_events
		delay = { days = 2 }
		bp1_misc_yearly_events
		delay = { days = 3 }
		indochina_yearly_events
		delay = { days = 5 }
		exiles_yearly_events
		delay = { days = 8 }
		historical_agitators_yearly_events
		delay = { days = 13 }
		slavery_abolition_yearly_events
		delay = { days = 21 }
		lobby_yearly_events
		delay = { days = 34 }
		krakatoa_yearly_events
		delay = { days = 55 }
		tunguska_yearly_events
		delay = { days = 89 }
		historical_agitators_yearly_events_moh
		delay = { days = 60 }
		qing_monarchy_yearly_events
	}
}