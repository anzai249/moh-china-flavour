REPLACE:je_opium_obsession = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	group = je_group_internal_affairs

	scripted_button = ban_opium_button
	scripted_button = unban_opium_button
	scripted_button = legalize_opium_button

	on_monthly_pulse = {
		random_events = {
			200 = 0
			10 = opium_wars.6
			5 = opium_wars.7
			5 = opium_wars.8
		}
		effect = {
			if = {
				limit = {
					is_banning_goods = opium
					is_at_war = no
				}
				change_variable = {
					name = opium_wars_completion_tracker
					add = 1
				}
			}
		}
	}

	complete = {
		scope:journal_entry = { is_goal_complete = yes }
		custom_tooltip = {
			text = opium_ban_tt
			is_banning_goods = opium
		}
		is_at_war = no
	}

	on_complete = {
		remove_variable = opium_wars_target
		trigger_event = {
			id = opium_wars.3
		}
	}

	fail = {
		OR = {
			has_law = law_type:law_free_trade
			any_country = {
				custom_tooltip = {
					text = opiumwars_fail_tt
					has_journal_entry = je_opium_wars
				}
				OR = {
					has_treaty_foreign_investment_rights_with = { TARGET = root }
					#has_treaty_port_in_market = root.market
					any_scope_state = {
						is_treaty_port = yes
						state_region = {
							any_scope_state = {
								owner = root
							}
						}
					}
				}
			}
		}
	}

	on_fail = {
		trigger_event = {
			id = opium_wars.4
		}
	}

	current_value = {
		value = root.var:opium_wars_completion_tracker
	}

	goal_add_value = {
		add = 60
	}

	invalid = {
		has_variable = shih_chin_legalized_opium
	}

    timeout = 4380
    on_timeout = {
		hidden_effect = { remove_modifier = opium_wars_addiction_modifier }
		add_modifier = {
			name = opium_wars_addiction_modifier
			days = long_modifier_time
		}
		add_radicals = {
			value = large_radicals
		}
		if = {
			limit = { has_journal_entry = je_warlord_china }
			chi_remove_1_fragile_unity = yes
		}
    }

	progressbar = yes
	display_progressbar_as_months = yes

	weight = 10000
	should_be_pinned_by_default = yes
}

je_shih_chin_opium = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"
	group = je_group_internal_affairs

	immediate = {
		set_variable = {
			name = shih_chin_opium_completion_tracker
			value = 0
		}
	}

	timeout = 7300

	complete = {
		custom_tooltip = {
			text = shih_chin_opium_complete_tt
			scope:journal_entry = { is_goal_complete = yes }
		}
		is_at_war = no
		market = {
			mg:opium = {
				market_goods_cheaper >= 0.05
			}
		}
		NOT = {
			any_market = {
				hidden_effect = {
					owner = {
						country_rank >= rank_value:major_power
					}
				}
				root.market = {
					market_imports_reliance = { target = prev goods = opium value > 0.05 }
				}
			}
		}
	}

	on_complete = {
		remove_variable = shih_chin_opium_completion_tracker
		trigger_event = {
			id = opium_wars.3
		}
	}

	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					is_at_war = no
					market = {
						mg:opium = {
							market_goods_cheaper >= 0.05
						}
					}
					# g:opium = {
					# 	world_market_imports <= 0
					# }
					NOT = {
						any_market = {
							hidden_effect = {
								owner = {
									country_rank >= rank_value:major_power
								}
							}
							root.market = {
								market_imports_reliance = { target = prev goods = opium value > 0.05 }
							}
						}
					}
				}
				change_variable = {
					name = shih_chin_opium_completion_tracker
					add = 1
				}
			}
		}
	}

	goal_add_value = {
		add = 180
	}

	current_value = {
		value = root.var:shih_chin_opium_completion_tracker
	}
	progressbar = yes
	display_progressbar_as_months = yes
	weight = 100
	should_be_pinned_by_default = yes
}